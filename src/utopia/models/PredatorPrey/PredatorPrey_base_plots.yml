# Base plot configuration pool for this model
#
# The configurations given here can be used in the <model_name>_plots.yml file.
---
.variables:
  base_path: &base_path data/PredatorPrey



# =============================================================================
#  ╔╦╗╔═╗╔╦╗╔═╗╦  ╔═╗╔╦╗╔═╗╔═╗
#   ║ ║╣ ║║║╠═╝║  ╠═╣ ║ ║╣ ╚═╗
#   ╩ ╚═╝╩ ╩╩  ╩═╝╩ ╩ ╩ ╚═╝╚═╝
# =============================================================================
# -- Overloads ----------------------------------------------------------------
# Overload some configs to insert model-specific settings

# Model-specific defaults
.defaults:
  based_on: .defaults

  # Can define something here ...


# .. Creators .................................................................
.creator.universe:
  based_on:
    - .creator.universe
    - .defaults

  dag_options:
    select_path_prefix: *base_path

.creator.multiverse:
  based_on:
    - .creator.multiverse
    - .defaults

  select_and_combine:
    base_path: *base_path

.calculate_densities:
  based_on:
    - .defaults
  select:
    area:
      path: ../../cfg/PredatorPrey
      transform:
        - getitem: [ !dag_prev , 'cell_manager' ]
        - getitem: [ !dag_prev , 'grid' ]
        - getitem: [ !dag_prev , 'resolution' ]
        - pow: [ !dag_prev , 2 ]
    predator:
      path: predator
      transform:
        - .where: [!dag_prev ==1, !dag_prev , 0]
        - .sum: [ !dag_prev , 'x' ]
        - .sum: [ !dag_prev , 'y' ]
        - div: [ !dag_prev , !dag_tag area ]
    prey:
      path: prey
      transform:
        - .where: [!dag_prev ==1, !dag_prev , 0]
        - .sum: [ !dag_prev , 'x' ]
        - .sum: [ !dag_prev , 'y' ]
        - div: [ !dag_prev , !dag_tag area ]


# =============================================================================
#  ╔═╗╦  ╔═╗╔╦╗╔═╗
#  ╠═╝║  ║ ║ ║ ╚═╗
#  ╩  ╩═╝╚═╝ ╩ ╚═╝
# =============================================================================
# -- Plot of the predator density against the prey density --------------------
phase_space:
  based_on:
    - .creator.universe
    - .calculate_densities
    - .plot.facet_grid.scatter
  transform:
    - operation: xr.Dataset
      kwargs:
        data_vars:
          predator: !dag_tag predator
          prey: !dag_tag prey
      tag: data

  # Set helpers accordingly
  helpers:
    set_labels:
      x: Predator Density $[1/A]$
      y: Prey Density $[1/A]$

  cmap: viridis_r

  # Parameters that are passed on to plt.scatter
  s: 3.5

  # Select the data
  x: predator
  y: prey
  hue: time



# -- Time series of the predator and prey densities ---------------------------
species_densities:
  based_on:
    - .creator.universe
    - .calculate_densities
    - .plot.facet_grid.line
  transform:
    - operation: xr.Dataset
      kwargs:
        data_vars:
          predator: !dag_tag predator
          prey: !dag_tag prey
    - .to_array: [!dag_prev ]
      kwargs:
        dim: 'kind'
      tag: data

  hue: 'kind'
  helpers:
    set_limits:
      x: [0, max]
    set_labels:
      y: Density $[1/A]$
    set_title:
      title: Predator and Prey Densities

# -- Time series of the predator and prey resources ---------------------------
mean_resources:
  based_on:
    - .defaults
    - .creator.universe
    - .plot.facet_grid.line
  select:
    resource_predator:
      path: resource_predator
      transform:
        - .where: [ !dag_prev ge 1, !dag_prev , 0]
        - .mean: [!dag_prev , ['x', 'y']]
    resource_prey:
      path: resource_prey
      transform:
        - .where: [ !dag_prev ge 1, !dag_prev , 0]
        - .mean: [!dag_prev , ['x', 'y']]
  transform:
    - operation: xr.Dataset
      kwargs:
        data_vars:
          predator: !dag_tag resource_predator
          prey: !dag_tag resource_prey
    - .to_array: [ !dag_prev ]
      kwargs:
        dim: 'kind'
      tag: data
  x: time
  hue: kind
  helpers:
    set_limits:
      x: [0, max]
      y: [0, ~]
    set_labels:
      y: Resource Density $[1/A]$
    set_title:
      title: Mean Total Resources


# -- A grid animation that shows combined predator and prey positions ---------
combined_grid_animation:
  based_on:
    - .creator.universe
    - .defaults
    - .plot.ca
