# Base configuration for ContDisease model plots
---
.variables:
  base_path: &base_path data/ContDisease

  colors:
    empty: &color_empty darkkhaki
    tree: &color_tree forestgreen
    infected: &color_infected firebrick
    source: &color_source orange
    stone: &color_stone slategray

    cycler: &cycler 'cycler(
        "color",
        ["darkkhaki", "forestgreen", "firebrick", "orange", "slategray",]
    )'

# -- Overloads ----------------------------------------------------------------
# Overload some configs to insert model-specific settings

.creator.universe:
  based_on: .creator.universe

  dag_options:
    select_path_prefix: *base_path

.creator.multiverse:
  based_on: .creator.multiverse

  select_and_combine:
    base_path: *base_path



# =============================================================================
# == PLOTS ====================================================================
# =============================================================================
# -- Any kind of phase plot ---------------------------------------------------
phase_diagram:  # TODO Consider migrating to facet grid scatter plot
  based_on: .default_style_and_helpers

  creator: universe
  universes: all

  module: model_plots.ContDisease
  plot_func: phase_diagram

  cmap: viridis_r

  helpers:
    set_title:
      title: Phase Diagram


# -- Densities plot -----------------------------------------------------------
densities.base:
  based_on:
    - .hlpr.kind.time_series
    - .plot.facet_grid.line

  x: time
  hue: kind

  style:
    axes.prop_cycle: *cycler

  helpers:
    set_limits:
      y: [0., 1.]
    set_labels:
      y: Density [1/A]
      only_label_outer: true
    set_suptitle:
      title: Densities
    set_legend:
      loc: best

densities.universe:
  based_on:
    - .creator.universe
    - densities.base

  select:
    data:
      path: densities
      transform:
        - .data

densities.multiverse:
  based_on:
    - .creator.multiverse
    - .skip.if_more_than_3D
    - densities.base
    - .plot.facet_grid.with_auto_encoding

  select_and_combine:
    fields:
      data:
        path: densities
        transform:
          - .data


# --- Grid Snapshots ----------------------------------------------------------
# NOTE These can also be used as basis for grid animations.
# ... The forest ..............................................................
ca/forest:
  based_on:
    - .creator.universe
    - .plot.ca

  select:
    kind: kind
  
  to_plot:
    kind:
      title: Forest State
      limits: [0, 4]
      cmap:
        empty: *color_empty
        tree: *color_tree
        infected: *color_infected
        source: *color_source
        stone: *color_stone

# ... The forest age ..........................................................
ca/forest_age:
  based_on:
    - .creator.universe
    - .plot.ca

  select:
    age: age

  to_plot:
    age:
      title: Forest Age
      cmap: YlGn
      limits: [0, max]

# ... The clusters ............................................................
ca/clusters:
  based_on:
    - .creator.universe
    - .plot.ca

  select:
    cluster_id:
      path: cluster_id
      transform:
        - where: [!dag_prev , "!=", 0]  # not part of the cluster
        - mod: [!dag_prev , 20]         # matching the size of the tab20 cmap

  to_plot:
    cluster_id:
      title: Clusters
      limits: [0, 20]
      cmap: tab20
      no_cbar_markings: true
